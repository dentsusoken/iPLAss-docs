=== 認証情報の管理

認証の対象とするユーザーの属性情報は、 `mtp.auth.User` エンティティとして登録します。

ただしパスワード情報やログイン情報などは `User` エンティティのプロパティとしては管理していません。
`t_account` テーブルとして物理DBテーブルに保存されます。

[[ref_user]]
==== ユーザー情報
ユーザーを管理するエンティティです。
認証で利用するプロパティ以外にもユーザーの属性に関する汎用的なプロパティが設定されています。

.認証に関する項目
[cols="1,3a", options="header"]
|===
|項目名|内容
|ユーザーID|ユーザーのログイン時に入力IDです。テナント単位で一意である必要があります。必須項目です。
|アカウントポリシー|ユーザーに対する<<authpolicy,認証ポリシー>>を指定します。
|有効開始日 .2+|有効期間を設定します。有効期間を設定した場合、期限外となると、対象ユーザーは認証時にエラーとなります。
|有効終了日
|メールアドレス|ユーザーのメールアドレスを設定します。パスワードをメールで通知する場合に利用します。
|一時ログインユーザー|一時的にログインを許可するユーザーを作成する場合に利用します。
|IPアドレス履歴|2段階認証機能で利用します。
|===

.それ以外の項目
[cols="1,3a", options="header"]
|===
|項目名|内容
|姓 .4+|ユーザーの姓名、姓名（カナ）をそれぞれ設定します。 +
姓のみ必須項目です。
|姓（カナ）
|名
|名（カナ）
|言語|テナントの多言語設定利用となっている場合のみ、設定した内容が有効となります。
iPLAssではユーザーの利用言語を設定する箇所が3つありますが、上のものほど優先度が高くなります。

* 汎用画面のメニューで選択した言語
* ユーザーEntityの言語
* テナントのデフォルトロケール
|管理者|システム管理者としてAdminConsoleの利用を許可する場合に設定します。
|所属グループ .2+|ユーザーをグループ化するための項目としてグループとランクという項目を標準で用意しています。
認可制御のためのロール管理で、条件として利用することも可能です。
|所属ランク
|===

CAUTION: 標準で設定されているプロパティは削除したり多重度を変更しないでください。
プロパティの追加やメールアドレスを必須にするなどの変更は構いません（必須を外すことはしないでください）。

[[t_account]]
==== t_account
ユーザーの認証に関する情報を保持するDatabaseのテーブルです。

[cols="1,3a", options="header"]
|===
|項目名 | 内容
| tenant_id | テナントのID。
| account_id | `User` エンティティのユーザーID。
| password | パスワード。暗号化されます。
| salt | パスワードを暗号化する際に付与されるデータ。
| oid | `User` エンティティのOID。
| last_login_on| 最終ログイン日時。
| login_err_cnt | ログイン失敗回数。
| login_err_date | 最終ログイン失敗日時。
| pol_name | `User` エンティティのアカウントポリシー名。
| last_password_change | 最終パスワード変更日時。
| cre_user | 作成ユーザー
| cre_date | 作成日時
| up_user | 更新ユーザー
| up_date | 更新日時
|===

パスワードの暗号化についての設定は、service-configの「AuthService」で指定します。
詳細については<<../../serviceconfig/index.adoc#AuthService,AuthService>>を参照してください。

==== ツール
認証情報は `User` エンティティと `t_account` で管理されているため、通常のエンティティ検索では情報が取得できません。
iPLAssではAdminConsole上に「BuiltinAuthUserExplorer」というツールを提供しています。 +
詳細は <<../support/index.adoc#tools_authuserexplorer, AuthUserExplorer>>を参照してください。
